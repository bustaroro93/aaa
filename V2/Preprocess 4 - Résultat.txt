======================================================================
   PREPROCESS 04 - MERGE GOD MODE
   TennisTitan SOTA 2026
======================================================================
   Timestamp: 2026-01-08 18:26:22
   Gender: atp
======================================================================

[1/11] Chargement matches_base (backbone)...
  Matches base: 543,927 rows
  Matches uniques: 543,927

[2/11] Chargement des feature layers...
  âœ… ratings_glicko2: 1,044,240 rows Ã— 165 cols
  âœ… ratings_srvret_layer: 1,088,490 rows Ã— 38 cols
  âœ… h2h_decay: 1,044,240 rows Ã— 11 cols
  âœ… psychological_momentum: 1,087,942 rows Ã— 21 cols
  âœ… environmental_context: 544,245 rows Ã— 19 cols
  âœ… charting_style: 1,087,854 rows Ã— 92 cols
  âœ… charting_super: 14,369 rows Ã— 81 cols
  âš ï¸ charting_player_rolling introuvable: C:\Users\Administrateur\Tennis POLAR v3\data_clean\features\charting_player_rolling
  âœ… baseline_markov: 1,087,942 rows Ã— 14 cols
  âœ… base_stats_rolling: 1,087,942 rows Ã— 73 cols
  âœ… charting_sequential: 37,746 rows Ã— 26 cols
  âœ… odds_layer: 48,472 rows Ã— 8 cols

[3/11] Merge Environmental Context...
  ğŸ“ env: 100.0% coverage (543,927/543,927)

[4/11] Merge SRV/RET Ratings...
  SRV/RET features: 29 colonnes Ã  pivoter
  ğŸ“ srvret_A: 100.0% coverage (543,927/543,927)
  ğŸ“ srvret_B: 100.0% coverage (543,927/543,927)
  âœ… SRV/RET mergÃ©: +58 colonnes

[5/11] Merge Glicko-2 Ratings...
  ğŸ“ ratings_A: 96.0% coverage (522,076/543,927)
  ğŸ“ ratings_B: 96.0% coverage (522,076/543,927)

[6/11] Merge Psychological Features...
  ğŸ“ psych_A: 100.0% coverage (543,927/543,927)
  ğŸ“ psych_B: 100.0% coverage (543,927/543,927)

[7/11] Merge Charting Style Features...
  ğŸ“ charting_A: 100.0% coverage (543,927/543,927)
  ğŸ“ charting_B: 100.0% coverage (543,927/543,927)
  ğŸ“ charting_super_A: 1.3% coverage (7,119/543,927)
  ğŸ“ charting_super_B: 1.3% coverage (6,982/543,927)

[7c/11] Merge Charting Player Rolling...

[7d/11] Merge Base Stats Rolling (100% coverage)...
  Base rolling features: 68
  ğŸ“ base_rolling_A: 99.7% coverage (542,554/543,927)
  ğŸ“ base_rolling_B: 97.1% coverage (528,140/543,927)
  âœ… Base Stats Rolling merged: +136 columns

[8/11] Merge H2H Features...
  ğŸ“ h2h_A: 26.5% coverage (144,159/543,927)
  ğŸ“ h2h_B: 26.5% coverage (144,159/543,927)

[9/11] Merge Baseline Markov...
  ğŸ“ markov_A: 46.3% coverage (251,600/543,927)
  ğŸ“ markov_B: 40.5% coverage (220,548/543,927)

[10/11] Merge Charting Sequential...
  AprÃ¨s agrÃ©gation: 14,147 rows
  ğŸ“ charting_seq_A: 1.3% coverage (6,943/543,927)
  ğŸ“ charting_seq_B: 1.3% coverage (6,815/543,927)

[11/11] Merge Odds Layer...
  ğŸ“ odds: 8.9% coverage (48,472/543,927)
  ğŸ° Matchs avec cotes: 48,472/543,927 (8.9%)

[POST] CrÃ©ation features dÃ©rivÃ©es...
  â­ï¸ glicko_prob_* skipped (will be calculated post-shuffle in PP9)
C:\Users\Administrateur\AppData\Local\Temp\ipykernel_5548\607578.py:731: DeprecationWarning: the `default` parameter for `replace` is deprecated. Use `replace_strict` instead to set a default while replacing values.
(Deprecated in version 1.0.0)
  pl.col("round_ta").replace(ROUND_ORDER, default=0).cast(pl.Int8).alias("round_num")
C:\Users\Administrateur\AppData\Local\Temp\ipykernel_5548\607578.py:744: DeprecationWarning: the `default` parameter for `replace` is deprecated. Use `replace_strict` instead to set a default while replacing values.
(Deprecated in version 1.0.0)
  pl.col("tourney_level_ta").replace(LEVEL_ORDER, default=1).cast(pl.Int8).alias("tourney_level_num")

======================================================================
   VALIDATION FINALE
======================================================================

  Shape finale: (543927, 1007)
  Colonnes: 1007

  Features par catÃ©gorie:
    â€¢ SRV/RET + Markov: 58
    â€¢ Glicko-2: 320
    â€¢ Psychological: 36
    â€¢ Environmental: 10
    â€¢ Charting: 319
    â€¢ H2H: 12
    â€¢ Sequential: 44
    â€¢ Meta/Derived: 72
    â€¢ Base Stats Rolling: 136

  Taux de null par catÃ©gorie:
    â€¢ Markov: 0.0% null
    â€¢ Glicko: 4.0% null
    â€¢ Mental: 0.0% null
    â€¢ Charting: 92.9% null

[WRITE] Ã‰criture du dataset unifiÃ©...
  âœ… C:\Users\Administrateur\Tennis POLAR v3\data_clean\ml_ready\matches_ml_ready.parquet
     Taille: 572.8 MB
  âœ… C:\Users\Administrateur\Tennis POLAR v3\data_clean\ml_ready\matches_ml_ready_partitioned (partitionnÃ© par annÃ©e)
  âœ… C:\Users\Administrateur\Tennis POLAR v3\data_clean\ml_ready\metadata.json

======================================================================
   PREPROCESS 2.2 TERMINÃ‰!
   Temps: 18.4s
======================================================================

======================================================================
   SANITY CHECK - DATASET MERGÃ‰
======================================================================

  Shape: (543927, 1007)
  âœ… Colonnes clÃ©s prÃ©sentes
  Features _A: 476
  Features _B: 478
  âœ… Target = 1 pour tous (A=winner) - OK pour shuffle
  AnnÃ©es: 1990 â†’ 2025 (36 annÃ©es)

  Distribution surfaces:
    â€¢ Hard: 261,990 (48.2%)
    â€¢ Clay: 254,544 (46.8%)
    â€¢ Grass: 15,357 (2.8%)
    â€¢ Carpet: 11,975 (2.2%)
    â€¢ None: 61 (0.0%)

  ğŸ‰ Sanity check passÃ©!

[SHUFFLE] CrÃ©ation dataset d'entraÃ®nement shufflÃ©...
  Paires A/B Ã  swapper: 476
  Distribution target aprÃ¨s shuffle:
    â€¢ 0: 272,399 (50.1%)
    â€¢ 1: 271,528 (49.9%)
  âœ… C:\Users\Administrateur\Tennis POLAR v3\data_clean\ml_ready\matches_ml_ready_shuffled.parquet

âœ… Preprocess 4 terminÃ©!

Prochaine Ã©tape:
  1. ExÃ©cuter create_shuffled_training_set() pour l'entraÃ®nement