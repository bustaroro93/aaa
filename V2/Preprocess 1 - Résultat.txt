======================================================================
   TENNISTITAN 2026 - PREPROCESS 1 GOD MODE (Polars)
======================================================================

============================================================
CELLULE C - PLAYERS_REF (Polars)
============================================================
[partition] gender = 'atp'
âœ” Ã‰crit â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\players_ref
âœ” players_ref â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\players_ref
âœ” Mapping nomâ†’ID â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\aux_data
âœ” Mapping nomâ†’ATPid â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\aux_data
============================================================
CELLULE A - BUILD MATCHES_BASE (Polars) - ATP
============================================================

[1/10] Lecture RAW (lazy)...
[ATP] Lecture de 65 fichiers...
[2/10] Nettoyage et normalisation...
       Rows: 544,249
[3/10] Classification niveaux tournois...
  âœ… Tourney level classification:
      I: 272,340 (50.0%)
      C: 138,039 (25.4%)
      B: 49,788 (9.1%)
      A: 30,554 (5.6%)
      M: 24,114 (4.4%)
      G: 21,596 (4.0%)
      DC: 5,567 (1.0%)
      X: 1,075 (0.2%)
      F: 418 (0.1%)
      O: 417 (0.1%)
      AC: 291 (0.1%)
      LC: 50 (0.0%)
  âœ… Unknown (X): 0.2% (target: <5%)
  âœ… Historical lookup used: 55,649 matches
[4/10] RÃ©conciliation IDs (mapping ATP)...
[5/10] GÃ©nÃ©ration TMP IDs (normalisÃ©s)...
[TMP IDs] 9337 nouveaux mappings ajoutÃ©s
[TMP IDs] Applied: winners=39781, losers=65655
[6/10] Upgrade TMPâ†’ATPid...
[TMPâ†’ATPid] Aucun upgrade nÃ©cessaire
[7/10] Flags qualifiers/WC/LL...
[8/10] DÃ©duplication best-row-wins...
       After dedup: 544,249
[9/10] Canonical join key...
       âœ… match_id_ta_dedup: 0 nulls
       âœ… match_key = clÃ© officielle (0 doublons)
[10/10] Validation finale...
[Validation] âš  4 matchs winner==loser exclus
       âœ… Anti-leakage check passed

[WRITE] Ã‰criture Parquet partitionnÃ©...
[partition] gender = 'atp'
[partition] year = 2006
âœ” Ã‰crit â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\matches_base

âœ… CELLULE A TERMINÃ‰E en 17.2s
   Total matchs: 544,245

============================================================
CHARTING_LONG (Polars)
============================================================
[charting] Loaded: 15,865,458 rows
[charting] After dedup: 13,278,337 rows
[partition] year = 2023
âœ” Ã‰crit â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\charting_long
âœ” charting_long â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\charting_long

============================================================
CELLULE B - ENHANCED QUALITY REPORTS (Polars)
============================================================
âœ” Reports â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\_reports
âœ” Uniques (gender, match_id_ta_dedup)
âœ” Coverage charting: 99.2%

============================================================
CELLULES D & E - SANITY CHECK SOTA 2026 (Polars)
============================================================
âœ” Toutes les colonnes obligatoires prÃ©sentes
âœ” SOTA: 'round_order' prÃ©sente
âœ” SOTA: 'match_sequence_key' prÃ©sente
âœ” SOTA: Tous les pourcentages en [0,1]
âœ” Aucun match winner==loser
âœ” UnicitÃ© OK
âœ” Classification niveaux OK (0.2% inconnus)

============================================================
âœ… SANITY CHECK PASSED

ðŸ“Š STATS:
   Total matchs: 544,245
   Surfaces: {'Carpet': 11980, None: 62, 'Clay': 254621, 'Grass': 15495, 'Hard': 262087}

============================================================
CELLULE F - CHARTING AGGREGATION (Polars)
============================================================
   match_key coverage: 14728/14728 (100.0%)
   match_key NULL: 0/14728 (0.0%)
   [charting_agg] match_key: 14,728/14,728 (100.0%)
âœ” charting_agg â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\aux_data\charting_agg.parquet
   Matchs: 7,365
   Features: 25

============================================================
CELLULE F-BIS - CHARTING SÃ‰QUENTIEL (Polars)
============================================================
[seq] Loaded: 13,278,337 rows
[seq] After filtering: 747,864 rows
[seq] present set-stats (10): ['1st_pct', '1stin', '2nd_pct', 'a_pct', 'bpsaved_opps', 'bpsaved_rate', 'df_pct', 'rpw_pct', 'ufe_fh_and_bh', 'winners_fh_and_bh']
[seq] missing set-stats (0): []
[seq] Coverage par stat:
   a_pct: 100.0%
   df_pct: 100.0%
   1stin: 100.0%
   1st_pct: 100.0%
   2nd_pct: 99.9%
   bpsaved_rate: 78.8%
   bpsaved_opps: 100.0%
   rpw_pct: 100.0%
   ufe_fh_and_bh: 100.0%
   winners_fh_and_bh: 100.0%
[seq] Pivot shape: (37746, 13)
[seq] Unique matches: 7,193
[seq] Years: [1996, 1997, 1998, 1999, 2000]...[2021, 2022, 2023, 2024, 2025]
   match_key coverage: 37746/37746 (100.0%)
   match_key NULL: 0/37746 (0.0%)
   [charting_sequential] match_key: 37,746/37,746 (100.0%)
[partition] year = 1996
âœ” Ã‰crit â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\features\charting_sequential

âœ” Charting sÃ©quentiel â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\features\charting_sequential
   Shape: (37746, 26)
   Matches: 7,193
   Set 1: 14,147 rows
   Set 2: 14,115 rows
   Set 3: 6,904 rows
   Set 4: 1,778 rows
   Set 5: 802 rows

âœ” Tensors â†’ C:\Users\Administrateur\Tennis POLAR v3\data_clean\features\charting_sequential\transformer_tensors.npz
   X_seq: (7193, 5, 10)
   mask_set: (7193, 5)
   mask_feat: (7193, 5, 10)
   Avg sets/match: 2.67

======================================================================
   ðŸ“Š RÃ‰SUMÃ‰ PREPROCESS 1 GOD MODE
======================================================================
   â±ï¸  Temps total: 33.5s
   ðŸ“ Matchs: 544,245
   ðŸ“… AnnÃ©es: 1942 â†’ 2025

   ðŸ“‚ Outputs:
      âœ… matches_base
      âœ… charting_long
      âœ… players_ref
      âœ… charting_agg
      âœ… charting_sequential

======================================================================
   ðŸŽ¯ PREPROCESS 1 GOD MODE COMPLETE
======================================================================